############################################################
# Dockerfile to build Python WSGI Application Containers
# Based on Ubuntu
############################################################

# Set the base image to Ubuntu
FROM ubuntu

# File Author / Maintainer
MAINTAINER carloha xuan

# Update the sources list
RUN apt-get update -y

# Install basic applications
RUN apt-get install -y vim


# Install Python and Basic Python Tools
RUN apt-get install -y python python-pip python-dev
RUN apt-get install -y libsqlite3-dev
RUN apt-get install -y libpq-dev

ENV CELERY_BROKER_URL redis://redis:6379/0
ENV CELERY_RESULT_BACKEND redis://redis:6379/0
ENV C_FORCE_ROOT true

# Upgrade PIP AND Install PIP Tools
RUN pip install --upgrade pip
RUN pip install redis


# Copy the application folder inside the container
ADD /carloha_market /carloha_market

# copy source code
#COPY . /carloha_market
#WORKDIR /carloha_market


# Get pip to download and install requirements:
RUN pip install -r /carloha_market/requirements.txt

# Expose ports
#EXPOSE 80


# Set the default directory where CMD will execute
WORKDIR /carloha_market

# Set the default command to execute    
# when creating a new container
# i.e. using CherryPy to serve the application
CMD celery worker -A run_worker_server.celery -l info &
CMD celery beat -A run_worker_server.celery -l info &



# run the worker
#ENTRYPOINT ['celery']
#CMD ['-A','tasks', 'worker','--loglevel=info']
#ENTRYPOINT celery -A tasks worker --loglevel=info